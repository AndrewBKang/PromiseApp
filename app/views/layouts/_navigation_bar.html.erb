<% if user_signed_in?%>
<header class="nav">
	<div class="navbar clearfix">
		<ul class="left-menu">
			<li><%= link_to("logo", resolutions_url) %></li>
			<li>
				<a class="request-tab" href="#">
					<% requests = current_user.friend_requests %>
					friend requests 
					<% if requests.length > 0 %>
						<strong class="badge"><%= requests.length %></strong> 
					<% end %>
				</a>
				<ul class="nav-dropdown requests-list bubble clearfix">
					<% requests.each do |request| %>
						<li class="clearfix">
							<div class="request">
								<div class="name"><%= link_to(request[:friendname],user_url(request[:user_id])) %></div>
								<%= button_to "Accept", friendship_url(request[:id]), method: "put", remote:true, class:"new_friend" %>
							</div>
						</li>
					<% end %>
				</ul>
			</li>
			<li>
				<% note_count = current_user.notifications_count %>
				<% if note_count > 0 %>
					<a class="notification-tab" data-remote="true" href="
						<%= read_url(note_count) %>">
				<% else %>
					<a class="notification-tab" href="#">
			  <% end %>
					notifications
					<% if note_count > 0 %>
						<strong class="badge"><%= note_count %></strong>
					<% end %>
				</a>
				<ul class="nav-dropdown notifications-list bubble clearfix">
					<% notifications = current_user.notifications.includes(:activity).reverse %>
					<% notifications.each do |note| %>
						<li>
							<div class="message">
								<%= link_to(note.message,user_url(note.activity.user_id)) %>
							</div>
						</li>
					<% end %>
				</ul>
			</li>
		</ul>
		
		<div class="search-bar">
			<input class="searchbar" value="searchbar">
		</div>
		
		<ul class="right-menu">
			<li>
				<a href="#" class="home-tab">home</a>
				<ul class="nav-dropdown home-message bubble">
					<li>
						<div class="message">
							under construction
						</div>
					</li>
				</ul>
			</li>
			<li><%= link_to("profile", profile_url) %></li>
			<li><%= link_to("logout", destroy_user_session_url, method: :delete)%></li>
		</ul>
	</div>
</header>

<% end %>

<script>

$('.button_to').on("ajax:success", function(event){
	$(event.target).parent().parent().hide();
	var $badge = $('.badge');
	($badge.text() == 1) ? $badge.addClass('friended') : $badge.text($badge.text()-1)
});

$('.notification-tab').on("ajax:success", function(){
	$(this).find('.badge').hide();
});

</script>